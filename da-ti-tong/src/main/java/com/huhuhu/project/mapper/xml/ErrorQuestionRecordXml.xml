<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.huhuhu.project.mapper.ErrorQuestionRecordMapper">

    <select id="categoryStatistic" resultType="java.util.Map">
        SELECT
        IFNULL(SUM(IF(`status` = 1, 1, 0)),0) AS successNum,
        IFNULL(SUM(IF(`status` = 2, 1, 0)),0) AS errorNum,
        IFNULL(SUM( IF ( `status` = 2 and DATE(NOW()) = DATE(create_time), 1, 0 )), 0 ) AS todayErrorNum,
        COUNT(1) as allNum,
        <foreach collection="names" item="item" separator=",">
            IFNULL(SUM(IF(question_type_name = #{item}, 1, 0)),0) as #{item}
        </foreach>
        FROM dtt_error_question_record
        WHERE category_id = #{categoryId} and user_id = #{userId}
    </select>
</mapper>

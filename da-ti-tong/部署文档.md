### 部署文档
#### docker部署
需要安装docker环境。
```
//-->卸载旧数据
sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
```

```
//--> 安装docker依赖
sudo yum install -y yum-utils
```

```
//--> 安装yum 源
sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
# 阿里云
yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo 
```

```
// 安装docker
sudo yum install docker-ce docker-ce-cli containerd.io
```

```
// 启动docker
sudo systemctl start docker
```

```
// 开启自启动docker
sudo systemctl enable docker
```

```
// 配置镜像加速器
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://e06lwqca.mirror.aliyuncs.com"]
}
EOF
```

```
// 保存
sudo systemctl daemon-reload
```

```
// 重启
sudo systemctl restart docker
```
安装docker compose
```
yum -y install wget
wget https://bootstrap.pypa.io/pip/2.7/get-pip.py
python get-pip.py
pip install docker-compose
```
在服务器上创建目录：  
1.mkdir /service  
2.修改配置文件，application-dev.yml中的`xxxx`替换成自己的配置，将docker-compose.yml中mysql的用户名和密码改成自己想要设置的，并且将application-dev.yml中的mysql用户名密码配置与其保持一致
docker-compose.yml文件里面修改的地方,将xxx改成自己想要设置的mysql账号密码
```
    environment:
      TZ: "Asia/Shanghai"
      MYSQL_ROOT_PASSWORD: "xxx"
      MYSQL_ALLOW_EMPTY_PASSWORD: "no"
      MYSQL_USER: 'xxx'
      MYSQL_PASSWORD: xxx'
```
application.yml文件
```
  datasource:
    url: jdbc:mysql://mysql:3306/shua-ti-tong?useUnicode=true&characterEncoding=utf-8&useSSL=false
    username: xxx
    password: xxx

# 小程序配置
wx_appid: xxx
wx_secret: xxx
# 阿里云oss 对象文件存储
aliyun:
  oss:
    endpoint: xxx
    accessKeyId: xxx
    accessKeySecret: xxx
    bucketName: datitong
    filedir: prod/doc/
# 阿里云短信
  sms:
    accessKey: xxx
    accessSecret: xxx
    tmpCode: xxxx
    signName: xxxxx

# 百度文字识别
baidu:
  appId: xxx
  appKey: xxx
  secretKey: xxx

# 微信支付
wechat:
  pay:
    v3:
      miniapp:
        app-id: xxx
        app-secret: xxx
        app-v3-secret: xxx
        mch-id: xxx
        domain: xxx
        cert-path: xxx

```
3.将java项目打成jar包 （mvn clean package）  
4.将java jar包、项目下的Dockerfile、docker-compose文件上传到/service 这个目录  
5.创建nginx挂载目录：
```
mkdir -p /service/nginx/html  
mkdir -p /service/nginx/conf.d  
touch /service/nginx/nginx.conf
```  
6.创建mysql挂载目录：
```
mkdir -p /service/mysql/conf.d  
mkdir -p /service/mysql/data  
mkdir -p /service/mysql/logs  
```
7.启动一个nginx：
```
docker run -d --name nginx nginx
```  
8.复制nginx容器中相关挂载文件：
```
docker cp nginx:/etc/nginx/nginx.conf /service/nginx/nginx.conf   
docker cp nginx:/usr/share/nginx/html /service/nginx/html  
docker cp nginx:/etc/nginx/conf.d /service/nginx/conf.d  
```
9.启动一个mysql
```
docker run -d --name mysql-test mysql
```
10.复制mysql容器相关挂载文件：
```
docker cp mysql:/etc/mysql/my.cnf /service/mysql/my.cnf  
docker cp mysql:/var/lib/mysql /service/mysql/data  
docker cp mysql:/logs /service/mysql/logs  
```
11.启动docker-compose
```
在/service 目录下执行：docker compose up -d 启动  
```
使用连接工具连接数据库
```
创建数据库 shua-ti-tong
导入数据库文件 shua-ti-tong.sql
```

将前端项目打的包上传到：/service/nginx/html   
解压：unzip 前端包名称  
修改nginx配置文件：
```
cd /service/nginx/conf.d  
vim default.conf  
```
-- 如果有域名在阿里云或者其他云服务，下载nginx证书，解压包：

```
   将解压出来的`key` 和 `密钥文件`放在挂载后的conf.d目录下，将nginx配置中的域名和
   证书文件配置成自己的，对应配置文件`ssl_certificate`、`ssl_certificate`、`ssl_certificate_key`
   (注意：服务器需要开放端口443)
```

将里面内容替换为下面的配置，按上面的描述修改成自己的配置：
```
server {
    listen 443 ssl;
    server_name  api.sygence.com;
    ssl_certificate /etc/nginx/conf.d/api.sygence.com.pem;
    ssl_certificate_key /etc/nginx/conf.d/api.sygence.com.key;
    ssl_session_timeout 5m;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    location / {
        root   /usr/share/nginx/html/;
        index  v3-admin-vite/index.html;
    }

   location /h5 {
        alias /usr/share/nginx/html/h5;
        index index.html;
   }

   location ^~ /assets/ {    ##4，同上
        root   /usr/share/nginx/html/h5/assets/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
   }

   location /da-ti-tong {
        proxy_pass http://da-ti-tong:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
   }
}
```
12. 后台管理页面部署

将 .env.production 文件中的路径替换成自己服务的
执行 npm run build:prod, 成功执行后会生成一个v3-admin-vite目录，将其压缩，上传到服务的/service/nginx/html目录下，重启nginx
初始管理员和密码：admin admin

13. 小程序端

将config.js中baseUrl换成自己的地址

---

以下为@胡工 部署配置

JAVA部署：

构建镜像
docker build -t eip .

查看命令,就会出现生成的镜像
docker images

构建网络名：eip_net
docker network create --driver bridge eip_net

查找网络的名称或者 ID
docker network ls

其中 eipcontainer是容器名   eip_net是网络名       eip是镜像名(刚刚上面生成的)

docker run -d --name eipcontainer --network eip_net -p 8088:8088 eip

检查命令
docker ps

nginx部署：

一、#拉取镜像
docker pull nginx:latest

二、#创建挂载目录
// 先创建nginx目录（以下是示例路径）
mkdir nginx
cd nginx/
// 创建配置文件挂载
mkdir conf
// 创建静态文件挂载
mkdir html
// 创建日志文件挂载
mkdir log
//创建密钥挂载目录
mkdir certs
// 列出目录
ls

三、#将所需文件在容器中复制出来
docker run -d docker.io/nginx:latest
#获取挂载文件
//将容器nginx.conf文件复制到宿主机
docker cp 容器id:/etc/nginx/nginx.conf /root/nginx/conf/nginx.conf
//将容器conf.d文件夹复制到宿主机
docker cp 容器id:/etc/nginx/conf.d /root/nginx/conf/conf.d
//将容器静态文件夹html复制到宿主机
docker cp 容器id:/usr/share/nginx/html/ /root/nginx
四、#停止容器，并删除
// 停止容器，ce869a为容器id
docker stop 容器id
//删除容器
docker rm 容器id

五、#启动Nginx容器
sudo docker run -d -p 80:80 --name nginx --privileged --restart always -v /home/shadow/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /home/shadow/nginx/conf/conf.d:/etc/nginx/conf.d -v /home/shadow/nginx/html:/usr/share/nginx/html -v /home/shadow/nginx/log:/var/log/nginx docker.io/nginx:latest

六、#上传ssl证书
、、、、、、、、、、、、、、、、、、

七、#修改配置文件（default.conf）
server {
    listen       80;
    listen  [::]:80;
    server_name pinruankao.com.cn; #填写域名
    #将所有HTTP请求通过rewrite指令重定向到HTTPS
    rewrite ^(.*) https://$server_name$1 permanent;
}

#配置443端口
server {
    listen 443 ssl;  # 1.1版本后这样写
    server_name pinruankao.com.cn; #填写域名
    ssl_certificate /home/shadow/nginx/certs/pinruankao.com.cn.pem;  #需要将cert-file-name.pem替换成已上传的证书文件的名称。
    ssl_certificate_key /home/shadow/nginx/certs/pinruankao.com.cn.key; #需要将cert-file-name.key替换成已上传的证书私钥文件的名称。
    ssl_session_timeout 5m;
    #表示使用的加密套件的类型。
    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3; #表示使用的TLS协议的类型。
    ssl_prefer_server_ciphers on;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_session_cache shared:SSL:1m;
    fastcgi_param  HTTPS        on;
    fastcgi_param  HTTP_SCHEME     https;

    location /da-ti-tong/customer/api/project/document/list {
        # 转发到目标地址
        proxy_pass http://47.108.239.130:8088/da-ti-tong/customer/api/project/document/list;
        proxy_set_header   X-Real-IP         $remote_addr;
        proxy_set_header   Host              $http_host;
        proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
    }

    location /da-ti-tong/admin/api/project/customer/list {
        # 转发到目标地址
        proxy_pass http://47.108.239.130:8088/da-ti-tong/admin/api/project/customer/list;
        proxy_set_header   X-Real-IP         $remote_addr;
        proxy_set_header   Host              $http_host;
        proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
    }
}

---

配置文件去注释内容

server {
    listen       80;
    listen  [::]:80;
    server_name pinruankao.com.cn;
    rewrite ^(.*) https://$server_name$1 permanent;
}

server {
    listen 443 ssl;
    server_name pinruankao.com.cn;
    ssl_certificate /home/shadow/nginx/certs/pinruankao.com.cn.pem;
    ssl_certificate_key /home/shadow/nginx/certs/pinruankao.com.cn.key;
    ssl_session_timeout 5m;
    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_session_cache shared:SSL:1m;
    fastcgi_param HTTPS on;
    fastcgi_param HTTP_SCHEME https;

    location /da-ti-tong/customer/api/project/document/list {
        proxy_pass http://47.108.239.130:8088/da-ti-tong/customer/api/project/document/list;
        proxy_set_header   X-Real-IP         $remote_addr;
        proxy_set_header   Host              $http_host;
        proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
    }

    location /da-ti-tong/admin/api/project/customer/list {
        proxy_pass http://47.108.239.130:8088/da-ti-tong/admin/api/project/customer/list;
        proxy_set_header   X-Real-IP         $remote_addr;
        proxy_set_header   Host              $http_host;
        proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
    }
}